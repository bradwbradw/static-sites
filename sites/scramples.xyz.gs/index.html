<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scramples</title>
  <link rel="manifest" href="manifest.json">

  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/dark-hive/jquery-ui.css">

  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>

<div class="top-bar">
  <marquee>SCRAMPLES</marquee>
</div>

<ul class="preferences">

  <li>
    <label id="file-picker-label" for="file_picker"> add audio </label>

    <input id="file_picker" type="file" accept="audio/*" multiple/>
  </li>
  <li>

    <label for="repeat-toggle" class="settings-toggle">
      looping: <span data-bind="css: {selectedSetting: repeat(), unSelectedSetting: !repeat()} ">on</span> / <span
        data-bind="css: {selectedSetting: !repeat(), unSelectedSetting: repeat()} ">off</span>
    </label>
    <input id="repeat-toggle" type="checkbox" data-bind="checked: repeat" style="display:none">
  </li>
  <li>

    <label for="sample-length-slider">

      duration: <span data-bind="text: roundedSampleLength"></span>s
    </label>

    <span id="sample-length-slider"
          data-bind='jqueryui: {
             widget: "slider",
             options: {
             min:0,
              max:30,
              step:0.01,
              value: sampleLengthString(),
              slide: function(evt,ui) { sampleLengthString(ui.value); }
             }
           }'>

    </span>


  </li>

  <li>
    <button data-bind="click: save, disable: saving, text: (saving()? 'saving...' : 'save')">save</button>
  </li>

</ul>

<section>
  <div data-bind="foreach: tracks ">
    <!--    <pre data-bind="text: ko.toJSON($data, null, 2)"></pre>-->

    <div class="track">
      <h3 data-bind="text: name"></h3> <div class="delete-icon"></div>
      <p data-bind="ifnot: buffer">processing audio...</p>
      <p data-bind="if: error"><span data-bind="text: error"></span></p>
      <div data-bind="foreach: samples">
        <div class="speaker-icon" data-bind="
      event: {
        click: function(data, event){ $root.playSample($parent, data, event) }
      }"></div>
      </div>
    </div>

  </div>
</section>

<!--<pre data-bind="text: ko.toJSON(tracks, null, 2)"></pre>-->

<script src="//code.jquery.com/jquery-1.12.4.js"></script>
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-debug.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dexie/2.0.4/dexie.min.js"></script>

<script type="text/javascript" src="scripts/jqueryui-binding.js"></script>

<script type="text/javascript" src="scripts/main.js"></script>

</body>


<script type="text/javascript">

  window.addEventListener('load', e => {
//  new PWAConfApp();
    registerSW(); // <-- Add this
  });

  async function registerSW() { // (1)
    if ('serviceWorker' in navigator) {
      console.log("Will the service worker register?");
      navigator.serviceWorker.register('./scripts/service-worker.js')
        .then(function (reg) {
          console.log("Service worker registered.");
        }).catch(function (err) {
        console.log("Service worker not registered. This happened: ", err)
      });
    }
  }

  
  https://developers.google.com/web/fundamentals/app-install-banners/#listen_for_beforeinstallprompt
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    // Prevent Chrome 67 and earlier from automatically showing the prompt
    e.preventDefault();
    // Stash the event so it can be triggered later.
    console.log("before install prompt triggered!");
    deferredPrompt = e;
  });

  function promptToInstall() {

  // Show the prompt
  deferredPrompt.prompt();
  // Wait for the user to respond to the prompt
  deferredPrompt.userChoice
    .then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the A2HS prompt');
      } else {
        console.log('User dismissed the A2HS prompt');
      }
      deferredPrompt = null;
    });
  }
</script>
</html>